
<!DOCTYPE html>
<html>
  <head>
    <title>Jitter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- D3 -->
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

    <!-- Application Code -->
    <script>let participants = {};</script>
    <script src="data/example-WI20S.json"></script>
    <script src="data/example-CR21S.json"></script>
    <script src="js/init.js"></script>
    <script src="js/Chart.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/RecoveryCycle.js"></script>
    <script src="js/ThresholdElectrotonus.js"></script>
    <script src="js/ChargeDuration.js"></script>
    <script src="js/ThresholdIV.js"></script>
    <script src="js/StimulusResponse.js"></script>
    <script src="js/StimulusRelative.js"></script>

    <style type="text/css">
      .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 2px;
      }
      .meanline {
        fill: none;
        stroke: darkgrey;
        stroke-width: 1px;
      }
      .confidenceinterval  {
        fill: lightgrey;
      }
    </style>

    <script>
      function toggle(id) {
        $(id + " .measures").toggleClass("d-none d-sm-flex")
      }
    </script>
  </head>
  <body class="bg-light">
    <div class="alert alert-success">
      <h1>Jitter - Nerve Data Explorer</h1>
      <div>Developed by <a href="https://bellstone.ca">Bellstone Engineering</a> and <a href="https://sites.ualberta.ca/~kejones/people.htm">Clinical & Theoretical Neuroscience Laboratory</a>.</div>
    </div>
    <div class="card-group">
      <div class="card">
        <div class="card-header">Filter</div>
        <div class="card-body row">
          <div>
            <label>Sex:</label>
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
              <label class="btn btn-secondary active"> <input type="radio" name="options" id="option1" autocomplete="off" checked> Any </label>
              <label class="btn btn-secondary"> <input type="radio" name="options" id="option2" autocomplete="off"> Male </label>
              <label class="btn btn-secondary"> <input type="radio" name="options" id="option3" autocomplete="off"> Female </label>
            </div>
          </div>
          <div class="">
            <label>Age:</label>
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
              <label class="btn btn-secondary active"> <input type="radio" name="options" id="option1" autocomplete="off" checked> Any </label>
              <label class="btn btn-secondary"> <input type="radio" name="options" id="option2" autocomplete="off"> 10 - 20 </label>
              <label class="btn btn-secondary"> <input type="radio" name="options" id="option2" autocomplete="off"> 20 - 30 </label>
              <label class="btn btn-secondary"> <input type="radio" name="options" id="option2" autocomplete="off"> 30 - 45 </label>
              <label class="btn btn-secondary"> <input type="radio" name="options" id="option2" autocomplete="off"> 45 - 65 </label>
              <label class="btn btn-secondary"> <input type="radio" name="options" id="option2" autocomplete="off"> 65+ </label>
            </div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">Participant: WI20S</div>
        <div class="card-body">
              <ul class="list-group list-group-flush d-none d-md-flex measures">
                <li id="overall-score" class="list-group-item"><span class="excite-name">Nerve Health</span>: <span class="excite-value">unknown</span></li>
                <li id="qtrac-excite-9" class="qtrac-excite list-group-item"><span class="excite-name">Temperature (&deg;C)</span>: <span class="excite-value">unknown</span></li>
                <li id="qtrac-excite-17" class="qtrac-excite list-group-item"><span class="excite-name">Age (years)</span>: <span class="excite-value">unknown</span></li>
                <li id="qtrac-excite-18" class="qtrac-excite list-group-item"><span class="excite-name">Sex (M=1, F=2)</span>: <span class="excite-value">unknown</span></li>
                <li id="qtrac-excite-19" class="qtrac-excite list-group-item"><span class="excite-name">Latency (ms)</span>: <span class="excite-value">unknown</span></li>
              </ul>
              <select id="select-participant-dropdown" class="btn btn-secondary float-right">
                <option value="CR21S">CR21S</option>
                <option value="WI20S">WI20S</option>
              </select>
        </div>
      </div>
    </div>
    <div class="card-columns">

      <div id="recoveryCycle" class="card border-success">
        <div class="card-header bg-success text-white">Recovery Cycle</div>
        <div class="card-body"><svg style="background-color: white; width: 100%" viewbox="30 -30 600 300" onclick="drawModal('Recovery Cycle', new RecoveryCycle(currentParticipant.plots).setDelayTime(Chart.fastDelay).setTransitionTime(Chart.fastTransition))"></svg></div>
        <ul class="list-group list-group-flush d-sm-flex d-md-none measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#recoveryCycle')" class="btn btn-sm float-right">Show</button>
          </li>
        </ul>
        <ul class="list-group list-group-flush d-none d-md-flex measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#recoveryCycle')" class="btn btn-sm float-right d-md-none">Hide</button>
          </li>
          <li id="qtrac-excite-10" class="qtrac-excite list-group-item"><span class="excite-name">RRP (ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-13" class="qtrac-excite list-group-item"><span class="excite-name">Superexcitability (%)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-14" class="qtrac-excite list-group-item"><span class="excite-name">Subexcitability (%)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-29" class="qtrac-excite list-group-item"><span class="excite-name">Refractoriness at 2.5ms (%)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-32" class="qtrac-excite list-group-item"><span class="excite-name">Refractoriness at 2 ms (%)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-33" class="qtrac-excite list-group-item"><span class="excite-name">Superexcitability at 7 ms (%)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-34" class="qtrac-excite list-group-item"><span class="excite-name">Superexcitability at 5 ms (%)</span>: <span class="excite-value">unknown</span></li>
        </ul>
      </div>

      <div id="thresholdElectrotonus" class="card border-danger">
        <div class="card-header bg-danger text-white">Threshold Electrotonus</div>
        <div class="card-body"><svg style="background-color: white; width: 100%" viewbox="30 -30 600 300" onclick="drawModal('Threshold Electrotonus', new ThresholdElectrotonus(currentParticipant.plots).setDelayTime(Chart.fastDelay).setTransitionTime(Chart.fastTransition))"></svg></div>
        <ul class="list-group list-group-flush d-sm-flex d-md-none measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#thresholdElectrotonus')" class="btn btn-sm float-right">Show</button>
          </li>
        </ul>
        <ul class="list-group list-group-flush d-none d-md-flex measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#thresholdElectrotonus')" class="btn btn-sm float-right d-md-none">Hide</button>
          </li>
          <li id="qtrac-excite-11" class="qtrac-excite list-group-item"><span class="excite-name">TEh(90&ndash;100ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-22" class="qtrac-excite list-group-item"><span class="excite-name">TEh(10&ndash;20ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-24" class="qtrac-excite list-group-item"><span class="excite-name">TEh(overshoot)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-30" class="qtrac-excite list-group-item"><span class="excite-name">TEh(20&ndash;40ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-31" class="qtrac-excite list-group-item"><span class="excite-name">TEh(slope 101&ndash;140ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-36" class="qtrac-excite list-group-item"><span class="excite-name">TEd40(Accom)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-12" class="qtrac-excite list-group-item"><span class="excite-name">TEd(10&ndash;20ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-20" class="qtrac-excite list-group-item"><span class="excite-name">TEd(40&ndash;60ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-21" class="qtrac-excite list-group-item"><span class="excite-name">TEd(90&ndash;100ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-23" class="qtrac-excite list-group-item"><span class="excite-name">TEd(undershoot)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-25" class="qtrac-excite list-group-item"><span class="excite-name">TEd(peak)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-27" class="qtrac-excite list-group-item"><span class="excite-name">Accommodation half-time (ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-38" class="qtrac-excite list-group-item"><span class="excite-name">TEh20(10&ndash;20ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-26" class="qtrac-excite list-group-item"><span class="excite-name">S2 accommodation</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-35" class="qtrac-excite list-group-item"><span class="excite-name">TEd20(peak)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-37" class="qtrac-excite list-group-item"><span class="excite-name">TEd20(10&ndash;20ms)</span>: <span class="excite-value">unknown</span></li>
        </ul>
      </div>

      <div id="chargeDuration" class="card border-success">
        <div class="card-header bg-success text-white">Charge Duration</div>
        <div class="card-body"><svg style="background-color: white; width: 100%" viewbox="30 -30 600 300" onclick="drawModal('Charge Duration', new ChargeDuration(currentParticipant.plots).setDelayTime(Chart.fastDelay).setTransitionTime(Chart.fastTransition))"></svg></div>
        <ul class="list-group list-group-flush d-sm-flex d-md-none measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#chargeDuration')" class="btn btn-sm float-right">Show</button>
          </li>
        </ul>
        <ul class="list-group list-group-flush d-none d-md-flex measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#chargeDuration')" class="btn btn-sm float-right d-md-none">Hide</button>
          </li>
          <li id="qtrac-excite-3" class="qtrac-excite list-group-item"><span class="excite-name">Strength-duration time constant (ms)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-4" class="qtrac-excite list-group-item"><span class="excite-name">Rheobase (mA)</span>: <span class="excite-value">unknown</span></li>
        </ul>
      </div>

      <div id="thresholdIV" class="card border-success">
        <div class="card-header bg-success text-white">Threshold I/V</div>
        <div class="card-body"><svg style="background-color: white; width: 100%" viewbox="30 -30 600 300" onclick="drawModal('Threshold I/V', new ThresholdIV(currentParticipant.plots).setDelayTime(Chart.fastDelay).setTransitionTime(Chart.fastTransition))"></svg></div>
        <ul class="list-group list-group-flush d-sm-flex d-md-none measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#thresholdIV')" class="btn btn-sm float-right">Show</button>
          </li>
        </ul>
        <ul class="list-group list-group-flush d-none d-md-flex measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#thresholdIV')" class="btn btn-sm float-right d-md-none">Hide</button>
          </li>
          <li id="qtrac-excite-7" class="qtrac-excite list-group-item"><span class="excite-name">Resting I/V slope</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-8" class="qtrac-excite list-group-item"><span class="excite-name">Minimum I/V slope</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-28" class="qtrac-excite list-group-item"><span class="excite-name">Hyperpolarization I/V slope</span>: <span class="excite-value">unknown</span></li>
        </ul>
      </div>

      <div id="stimulusResponseRelative" class="card border-success">
        <div class="card-header bg-success text-white">Stimulus Response (Relative)</div>
        <div class="card-body"><svg style="background-color: white; width: 100%" viewbox="30 -30 600 300" onclick="drawModal('Stimulus Response (Relative)', new StimulusRelative(currentParticipant.plots).setDelayTime(Chart.fastDelay).setTransitionTime(Chart.fastTransition))"></svg></div>
        <ul class="list-group list-group-flush d-sm-flex d-md-none measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#stimulusResponseRelative')" class="btn btn-sm float-right">Show</button>
          </li>
        </ul>
        <ul class="list-group list-group-flush d-none d-md-flex measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#stimulusResponseRelative')" class="btn btn-sm float-right d-md-none">Hide</button>
          </li>
          <li id="qtrac-excite-1" class="qtrac-excite list-group-item"><span class="excite-name">Stimulus (mA) for 50% max response</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-6" class="qtrac-excite list-group-item"><span class="excite-name">Peak response (mV)</span>: <span class="excite-value">unknown</span></li>
          <li id="qtrac-excite-5" class="qtrac-excite list-group-item"><span class="excite-name">Stimulus-response slope</span>: <span class="excite-value">unknown</span></li>
        </ul>
      </div>

      <div id="stimulusResponse" class="card border-success">
        <div class="card-header bg-success text-white">Stimulus Response</div>
        <div class="card-body"><svg style="background-color: white; width: 100%" viewbox="30 -30 600 300" onclick="drawModal('Stimulus Response', new StimulusResponse(currentParticipant.plots).setDelayTime(Chart.fastDelay).setTransitionTime(Chart.fastTransition))"></svg></div>
        <ul class="list-group list-group-flush d-sm-flex d-md-none measures">
          <li class="list-group-item bg-light">
            Discrete Measures
            <button onclick="toggle('#stimulusResponse')" class="btn btn-sm float-right">Show</button>
          </li>
        </ul>
      </div>
    </div>


    <div id="modal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document" style="max-width: 80%">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="modal-title" class="modal-title" >Modal title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <svg style="background-color: white; width: 100%" viewbox="30 -30 600 300"></svg>
          </div>
        </div>
      </div>
    </div>


    <script>
      let currentParticipant = participants["CR21S"];
      initPlots(currentParticipant);
    </script>
  </body>
</html>
